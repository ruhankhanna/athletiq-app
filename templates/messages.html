<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/messages.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    <script src="https://kit.fontawesome.com/8a3f3507f1.js" crossorigin="anonymous"></script>
</head>
<body>
    <nav>
        <a href="/">
            <img class="logo" src="/static/images/AthletIQ (1).png" alt="AthletIQ Logo" />
        </a>
       <div class="nav-right">
    

          <div class="profile-button-container">
            <a href="/dashboard">
              <div class="profile-button">
                <i class="fa-solid fa-user" style="color: #ffffff;"></i>
              </div>
            </a>
          </div>

          <div class="menu-button-container">
          <div class="menu-button" onclick="toggleMenu()">
              <i class="fa-solid fa-bars" style="color: #ffffff;"></i>
          </div>
          <div class="menu-content">
              <ul>
                  <li><a href="/">Home</a></li>
                  <li><a href="/rankings">Rankings</a></li>
                  <li><a href="/about">About</a></li>
                  <li><a href="/login">Log in</a></li>
                  <li><a href="/logout"><i class="fa-solid fa-sign-out-alt" style="color: #ffffff;"></i> Log out</a></li>
              </ul>
          </div>
        </div>

        </nav>

    <div class="messages-container">
        <div class="sidebar">
            <form action="/messages" method="get" class="search-bar">
                <input type="text" name="query" placeholder="Search by name..." required>
                <button type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
            </form>

            {% if search_results %}
              <div class="search-results">
                  <h3>Search Results:</h3>
                  {% for user in search_results %}
                      <div class="search-result-item">
                          <a href="{{ url_for('messages', receiver_email=user.email) }}">
                              <span class="user-name">{{ user.name }}</span>
                          
                          </a>
                      </div>
                  {% else %}
                      <p class="no-results">No matching users found.</p>
                  {% endfor %}
              </div>
          {% endif %}



            <h3>Recent Conversations</h3>
            <ul class="conversation-list">
              {% for partner in conversations %}
                <li>
                  <a href="{{ url_for('messages', receiver_email=partner.email) }}"
                    class="{% if partner.has_unread %}unread-convo{% endif %}">
                    {{ partner.name }}
                  </a>
                </li>
              {% endfor %}
            </ul>

        </div>

        <div class="chat-panel">
            {% if receiver_email %}
                <h2 class="chat-header">Chat with {{ receiver_name }}</h2>

                <div class="message-box">
                    {% for msg in messages %}
                        <div class="message {% if msg[0] == sender_email %}sent{% else %}received{% endif %}">
                            <p>{{ msg[2] }}</p>
                            <span class="timestamp">{{ msg[3].strftime("%b %d, %H:%M") }}</span>
                        </div>
                    {% endfor %}
                </div>

                <form action="{{ url_for('send_message') }}" method="post" class="message-form">
                    <input type="hidden" name="receiver_email" value="{{ receiver_email }}">
                    <input type="text" name="content" placeholder="Type a message..." required>
                    <button type="submit"><i class="fa-solid fa-paper-plane"></i></button>
                </form>
            {% else %}
                <p class="empty-chat">Select a conversation or enter an email to start chatting.</p>
                <p class="empty-chat-warning">Warning: athletIQ reserves the right to disable your messaging and/or suspend your account if you spam or send inappropriate content.</p>
            {% endif %}
        </div>
    </div>
  <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
  <footer class="site-footer">
            <div class="footer-container">
                <div class="footer-left">
                <img src="{{ url_for('static', filename='images/AthletIQ (1).png') }}" alt="AthletIQ Logo" class="footer-logo-img">
                <p>&copy; {{ current_year }} AthletIQ LLC. All rights reserved.</p>
                </div>
                <div class="footer-right">
                <a href="https://www.instagram.com/athletiq.run/" target="_blank" aria-label="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://www.linkedin.com/company/athletiq-rating/?viewAsMember=true" target="_blank" aria-label="LinkedIn">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="mailto:ruhan@athletiq.run" aria-label="Email">
                    <i class="fas fa-envelope"></i>
                </a>
                </div>
            </div>
    </footer>
</body>
</html>
